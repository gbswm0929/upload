<!-- <!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë™ì˜ìƒ ì—…ë¡œë“œ</title>
  <style>
    body { font-family: sans-serif; margin: 40px; }
    .video-item { cursor: pointer; color: blue; text-decoration: underline; margin: 4px 0; }
    #progressContainer {
      margin-top: 20px;
      display: none;
      width: 100%;
      background: #eee;
      border-radius: 6px;
      overflow: hidden;
      height: 20px;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background: #4CAF50;
      text-align: center;
      color: white;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¬ ë™ì˜ìƒ ì—…ë¡œë“œ</h1>

  <form id="uploadForm">
    <input type="file" name="video" accept="video/*" required>
    <button type="submit">ì—…ë¡œë“œ</button>
  </form> -->

  <!-- ì—…ë¡œë“œ ì§„í–‰ë¥  -->
  <!-- <div id="progressContainer">
    <div id="progressBar">0%</div>
  </div>

  <hr>

  <h2>ì—…ë¡œë“œëœ ë™ì˜ìƒ ëª©ë¡</h2>
  <div id="videoList"></div> -->

  <!-- <script>
    // ì—…ë¡œë“œ ì§„í–‰ í‘œì‹œ ê¸°ëŠ¥
    const form = document.getElementById("uploadForm");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const fileInput = form.querySelector("input[name='video']");
      if (!fileInput.files.length) return alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!");

      const formData = new FormData();
      formData.append("video", fileInput.files[0]);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/upload", true);

      // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
      xhr.upload.onprogress = function (event) {
        if (event.lengthComputable) {
          const percent = Math.round((event.loaded / event.total) * 100);
          progressContainer.style.display = "block";
          progressBar.style.width = percent + "%";
          progressBar.textContent = percent + "%";
        }
      };

      // ì—…ë¡œë“œ ì™„ë£Œ í›„
      xhr.onload = function () {
        if (xhr.status === 200) {
          progressBar.textContent = "ì™„ë£Œ!";
          setTimeout(() => {
            progressContainer.style.display = "none";
            progressBar.style.width = "0%";
            loadVideos();
            fileInput.value = "";
          }, 1000);
        } else {
          alert("ì—…ë¡œë“œ ì‹¤íŒ¨: " + xhr.responseText);
        }
      };

      xhr.send(formData);
    });

    // ì—…ë¡œë“œëœ ì˜ìƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadVideos() {
      const res = await fetch("/list");
      const videos = await res.json();
      const listDiv = document.getElementById("videoList");
      listDiv.innerHTML = "";

      videos.forEach((v) => {
        const link = document.createElement("div");
        link.textContent = v.name;
        link.className = "video-item";
        link.onclick = () => window.open(v.url, "_blank");
        listDiv.appendChild(link);
      });
    }

    loadVideos();
  </script> -->
<!-- </body>
</html> -->





<!-- <!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë™ì˜ìƒ ì—…ë¡œë“œ</title>
  <style>
    body { font-family: sans-serif; margin: 40px; }
    .video-item { cursor: pointer; color: blue; text-decoration: underline; margin: 4px 0; }
    #progressContainer {
      margin-top: 20px;
      display: none;
      width: 100%;
      background: #eee;
      border-radius: 6px;
      overflow: hidden;
      height: 20px;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background: #4CAF50;
      text-align: center;
      color: white;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¬ ë™ì˜ìƒ ì—…ë¡œë“œ</h1>

  <form id="uploadForm">
    <input type="file" name="video" accept="video/*" required>
    <button type="submit">ì—…ë¡œë“œ</button>
  </form> -->

  <!-- ì—…ë¡œë“œ ì§„í–‰ë¥  -->
  <!-- <div id="progressContainer">
    <div id="progressBar">0%</div>
  </div>

  <hr>

  <h2>ì—…ë¡œë“œëœ ë™ì˜ìƒ ëª©ë¡</h2>
  <div id="videoList"></div> -->

  <!-- <script>
    // ì—…ë¡œë“œ ì§„í–‰ í‘œì‹œ ê¸°ëŠ¥
    const form = document.getElementById("uploadForm");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const fileInput = form.querySelector("input[name='video']");
      if (!fileInput.files.length) return alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!");

      const formData = new FormData();
      formData.append("video", fileInput.files[0]);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/upload", true);

      // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
      xhr.upload.onprogress = function (event) {
        if (event.lengthComputable) {
          const percent = Math.round((event.loaded / event.total) * 100);
          progressContainer.style.display = "block";
          progressBar.style.width = percent + "%";
          progressBar.textContent = percent + "%";
        }
      };

      // ì—…ë¡œë“œ ì™„ë£Œ í›„
      xhr.onload = function () {
        if (xhr.status === 200) {
          progressBar.textContent = "ì™„ë£Œ!";
          setTimeout(() => {
            progressContainer.style.display = "none";
            progressBar.style.width = "0%";
            loadVideos();
            fileInput.value = "";
          }, 1000);
        } else {
          alert("ì—…ë¡œë“œ ì‹¤íŒ¨: " + xhr.responseText);
        }
      };

      xhr.send(formData);
    });

    // ì—…ë¡œë“œëœ ì˜ìƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadVideos() {
      const res = await fetch("/list");
      const videos = await res.json();
      const listDiv = document.getElementById("videoList");
      listDiv.innerHTML = "";

      videos.forEach((v) => {
        const link = document.createElement("a");
        link.href = v.url;
        link.textContent = v.name;
        link.target = "_blank"; // ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
        link.style.display = "block";
        listDiv.appendChild(link);
      });
    }

    loadVideos();
  </script> -->
<!-- </body>
</html> -->





<!-- <!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë™ì˜ìƒ ì—…ë¡œë“œ</title>
  <style>
    body { font-family: sans-serif; margin: 40px; }
    a.video-item { display: inline-block; color: blue; text-decoration: underline; margin-right: 10px; }
    button.delete-btn { background: #f44336; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
    #progressContainer {
      margin-top: 20px;
      display: none;
      width: 100%;
      background: #eee;
      border-radius: 6px;
      overflow: hidden;
      height: 20px;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background: #4CAF50;
      text-align: center;
      color: white;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¬ ë™ì˜ìƒ ì—…ë¡œë“œ</h1>

  <form id="uploadForm">
    <input type="file" name="video" accept="video/*" required>
    <button type="submit">ì—…ë¡œë“œ</button>
  </form> -->

  <!-- ì—…ë¡œë“œ ì§„í–‰ë¥  -->
  <!-- <div id="progressContainer">
    <div id="progressBar">0%</div>
  </div>

  <hr>

  <h2>ì—…ë¡œë“œëœ ë™ì˜ìƒ ëª©ë¡</h2>
  <div id="videoList"></div>

  <script>
    // ì—…ë¡œë“œ ì§„í–‰ í‘œì‹œ
    const form = document.getElementById("uploadForm");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const fileInput = form.querySelector("input[name='video']");
      if (!fileInput.files.length) return alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!");

      const formData = new FormData();
      formData.append("video", fileInput.files[0]);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/upload", true);

      xhr.upload.onprogress = function (event) {
        if (event.lengthComputable) {
          const percent = Math.round((event.loaded / event.total) * 100);
          progressContainer.style.display = "block";
          progressBar.style.width = percent + "%";
          progressBar.textContent = percent + "%";
        }
      };

      xhr.onload = function () {
        if (xhr.status === 200) {
          progressBar.textContent = "ì™„ë£Œ!";
          setTimeout(() => {
            progressContainer.style.display = "none";
            progressBar.style.width = "0%";
            loadVideos();
            fileInput.value = "";
          }, 800);
        } else {
          alert("ì—…ë¡œë“œ ì‹¤íŒ¨: " + xhr.responseText);
        }
      };

      xhr.send(formData);
    });

    // ğŸ”¥ ì‚­ì œ ìš”ì²­ í•¨ìˆ˜
    async function deleteVideo(filename) {
      const code = prompt("ë¹„ë°€ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
      if (!code) return;

      const confirmName = prompt(`ì‚­ì œí•  íŒŒì¼ ì´ë¦„(${filename})ì„ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”:`);
      if (confirmName !== filename) {
        alert("íŒŒì¼ ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return;
      }

      const res = await fetch("/delete", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ filename, code }),
      });

      const data = await res.json();
      if (res.ok) {
        alert("âœ… ì‚­ì œ ì™„ë£Œ!");
        loadVideos();
      } else {
        alert("âŒ " + data.error);
      }
    }

    // ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ í‘œì‹œ
    async function loadVideos() {
      const res = await fetch("/list");
      const videos = await res.json();
      const listDiv = document.getElementById("videoList");
      listDiv.innerHTML = "";

      videos.forEach((v) => {
        const link = document.createElement("a");
        link.href = v.url;
        link.textContent = v.name;
        link.target = "_blank";
        link.className = "video-item";

        const delBtn = document.createElement("button");
        delBtn.textContent = "ì‚­ì œ";
        delBtn.className = "delete-btn";
        delBtn.onclick = () => deleteVideo(v.name);

        const itemDiv = document.createElement("div");
        itemDiv.appendChild(link);
        itemDiv.appendChild(delBtn);

        listDiv.appendChild(itemDiv);
      });
    }

    loadVideos();
  </script>
</body>
</html> -->





<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë™ì˜ìƒ ì—…ë¡œë“œ</title>
  <style>
    body { font-family: sans-serif; margin: 40px; background: #fafafa; }
    a.video-item { color: #007bff; text-decoration: none; margin-right: 10px; }
    button.delete-btn { background: #f44336; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
    #progressContainer {
      margin-top: 20px;
      display: none;
      width: 100%;
      background: #eee;
      border-radius: 6px;
      overflow: hidden;
      height: 20px;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background: #4CAF50;
      text-align: center;
      color: white;
      font-size: 12px;
    }

    /* ğŸ”’ ëª¨ë‹¬ì°½ ìŠ¤íƒ€ì¼ */
    .modal-bg {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal {
      background: white;
      border-radius: 10px;
      padding: 20px;
      width: 300px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      text-align: center;
    }
    .modal h3 {
      margin-bottom: 10px;
    }
    .modal input {
      width: 90%;
      padding: 6px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .modal button {
      margin-top: 10px;
      background: #4CAF50;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    .modal .cancel {
      background: #888;
      margin-left: 10px;
    }
    .error {
      color: red;
      font-size: 12px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¬ ë™ì˜ìƒ ì—…ë¡œë“œ</h1>

  <form id="uploadForm">
    <input type="file" name="video" accept="video/*" required>
    <button type="submit">ì—…ë¡œë“œ</button>
  </form>

  <div id="progressContainer">
    <div id="progressBar">0%</div>
  </div>

  <hr>

  <h2>ì—…ë¡œë“œëœ ë™ì˜ìƒ ëª©ë¡</h2>
  <div id="videoList"></div>

  <!-- ğŸ”’ ì‚­ì œ ëª¨ë‹¬ -->
  <div class="modal-bg" id="deleteModal">
    <div class="modal">
      <h3>ë™ì˜ìƒ ì‚­ì œ</h3>
      <p id="deleteFilename"></p>
      <input type="password" id="deleteCode" placeholder="ë¹„ë°€ ì½”ë“œ ì…ë ¥">
      <input type="text" id="confirmName" placeholder="íŒŒì¼ ì´ë¦„ ì¬ì…ë ¥">
      <div class="error" id="errorMsg"></div>
      <button id="confirmDelete">ì‚­ì œ</button>
      <button class="cancel" id="cancelDelete">ì·¨ì†Œ</button>
    </div>
  </div>

  <script>
    const form = document.getElementById("uploadForm");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");

    // ì—…ë¡œë“œ
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const fileInput = form.querySelector("input[name='video']");
      if (!fileInput.files.length) return alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!");

      const formData = new FormData();
      formData.append("video", fileInput.files[0]);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/upload", true);

      xhr.upload.onprogress = function (event) {
        if (event.lengthComputable) {
          const percent = Math.round((event.loaded / event.total) * 100);
          progressContainer.style.display = "block";
          progressBar.style.width = percent + "%";
          progressBar.textContent = percent + "%";
        }
      };

      xhr.onload = function () {
        if (xhr.status === 200) {
          progressBar.textContent = "ì™„ë£Œ!";
          setTimeout(() => {
            progressContainer.style.display = "none";
            progressBar.style.width = "0%";
            loadVideos();
            fileInput.value = "";
          }, 800);
        } else {
          alert("ì—…ë¡œë“œ ì‹¤íŒ¨: " + xhr.responseText);
        }
      };

      xhr.send(formData);
    });

    // ëª©ë¡ í‘œì‹œ
    async function loadVideos() {
      const res = await fetch("/list");
      const videos = await res.json();
      const listDiv = document.getElementById("videoList");
      listDiv.innerHTML = "";

      videos.forEach((v) => {
        const link = document.createElement("a");
        link.href = v.url;
        link.textContent = v.name;
        link.target = "_blank";
        link.className = "video-item";

        const delBtn = document.createElement("button");
        delBtn.textContent = "ì‚­ì œ";
        delBtn.className = "delete-btn";
        delBtn.onclick = () => openDeleteModal(v.name);

        const itemDiv = document.createElement("div");
        itemDiv.appendChild(link);
        itemDiv.appendChild(delBtn);
        listDiv.appendChild(itemDiv);
      });
    }

    // ğŸ”’ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
    const modalBg = document.getElementById("deleteModal");
    const deleteFilename = document.getElementById("deleteFilename");
    const deleteCode = document.getElementById("deleteCode");
    const confirmName = document.getElementById("confirmName");
    const errorMsg = document.getElementById("errorMsg");
    const confirmBtn = document.getElementById("confirmDelete");
    const cancelBtn = document.getElementById("cancelDelete");

    let currentFile = null;

    function openDeleteModal(filename) {
      currentFile = filename;
      deleteFilename.textContent = `ì‚­ì œí•  íŒŒì¼: ${filename}`;
      deleteCode.value = "";
      confirmName.value = "";
      errorMsg.textContent = "";
      modalBg.style.display = "flex";
    }

    cancelBtn.onclick = () => modalBg.style.display = "none";

    confirmBtn.onclick = async () => {
      const code = deleteCode.value.trim();
      const nameCheck = confirmName.value.trim();

      if (!code || !nameCheck) {
        errorMsg.textContent = "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
        return;
      }
      if (nameCheck !== currentFile) {
        errorMsg.textContent = "íŒŒì¼ ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        return;
      }

      const res = await fetch("/delete", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ filename: currentFile, code }),
      });
      const data = await res.json();

      if (!res.ok) {
        errorMsg.textContent = data.error;
      } else {
        alert("âœ… ì‚­ì œ ì™„ë£Œ!");
        modalBg.style.display = "none";
        loadVideos();
      }
    };

    loadVideos();
  </script>
</body>
</html>
